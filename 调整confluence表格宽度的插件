ä½ é‡åˆ°çš„é—®é¢˜å…¶å®æ˜¯ DOM ç»“æ„å’Œé€‰æ‹©å™¨çš„é—®é¢˜ï¼šè™½ç„¶èƒ½æ‹¿åˆ° <table>ï¼Œä½†åœ¨ Confluence çš„é¡µé¢é‡Œï¼Œè¡¨æ ¼å¾€å¾€æœ‰åµŒå¥—çš„æ ·å¼æˆ–ç‰¹æ®Šçš„ classï¼Œå¯¼è‡´ç›´æ¥ç”¨ querySelectorAll("tr td") ä¸ç¨³å®šã€‚è¦ç²¾ç¡®è°ƒæ•´åˆ—å®½ï¼Œæ¨èç”¨ <colgroup> æ¥æ§åˆ¶ï¼Œè€Œä¸æ˜¯é€ä¸ª <td>ã€‚

---

âœ… æ¨èåšæ³•ï¼šä½¿ç”¨ `<colgroup>` æ§åˆ¶åˆ—å®½

function adjustTableColumns(table, mode = "average", fixedWidth = 150) {
  const firstRow = table.querySelector("tr");
  if (!firstRow) return;

  const cols = firstRow.querySelectorAll("td, th");
  const colCount = cols.length;
  if (colCount === 0) return;

  // å¦‚æœæ²¡æœ‰ colgroupï¼Œå…ˆåˆ›å»º
  let colgroup = table.querySelector("colgroup");
  if (!colgroup) {
    colgroup = document.createElement("colgroup");
    for (let i = 0; i < colCount; i++) {
      const col = document.createElement("col");
      colgroup.appendChild(col);
    }
    table.insertBefore(colgroup, table.firstChild);
  }

  // è®¾ç½®å®½åº¦
  const colElements = colgroup.querySelectorAll("col");
  colElements.forEach((col, i) => {
    if (mode === "fixed") {
      col.style.width = fixedWidth + "px";
    } else {
      col.style.width = (100 / colCount) + "%";
    }
  });
}

// éå†æ‰€æœ‰ Confluence è¡¨æ ¼
document.querySelectorAll("table.confluenceTable").forEach(table => {
  adjustTableColumns(table, "average"); // æˆ– "fixed"
});


---

ğŸ”‘ ä¸ºä»€ä¹ˆç”¨ `<colgroup>`

â€¢ <td> å’Œ <th> çš„å®½åº¦åªæ˜¯å»ºè®®ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´ï¼Œå®¹æ˜“å¤±æ•ˆã€‚
â€¢ <colgroup> å’Œ <col> æ˜¯ä¸“é—¨ç”¨æ¥å®šä¹‰åˆ—å®½çš„ï¼Œèƒ½ä¿è¯æ‰€æœ‰å•å…ƒæ ¼ç»Ÿä¸€ã€‚
â€¢ è¿™æ ·ä½ åªéœ€è¦è®¾ç½®ä¸€æ¬¡ï¼Œä¸å¿…é€ä¸ªå•å…ƒæ ¼å»æ”¹ã€‚


---

âš™ï¸ åŠ¨æ€åŠ è½½æ”¯æŒ

å¦‚æœ Confluence é¡µé¢æ˜¯ SPAï¼Œå¯ä»¥ç”¨ MutationObserverï¼š

const observer = new MutationObserver(() => {
  document.querySelectorAll("table.confluenceTable").forEach(table => {
    adjustTableColumns(table, "average");
  });
});

observer.observe(document.body, { childList: true, subtree: true });


---

è¿™æ ·ä½ å°±èƒ½ç¨³å®šåœ°è·å–è¡¨æ ¼ï¼Œå¹¶ä¸”å‡†ç¡®è°ƒæ•´æ¯ä¸€åˆ—çš„å®½åº¦ã€‚

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª å®Œæ•´æ’ä»¶ç‰ˆæœ¬ï¼Œç›´æ¥ç”¨ <colgroup> æ¥æ§åˆ¶åˆ—å®½ï¼Œè€Œä¸æ˜¯é€ä¸ª <td>ï¼Œè¿™æ ·æ›´ç¨³å¥ï¼Ÿ

