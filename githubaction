在本地调试 GitHub Actions 的 YAML，其实是很多开发者都会遇到的痛点。好消息是：可以本地调试，而且方式不止一种。我给你一个清晰、可操作、适合你这种偏系统化工作流优化风格的方案。

---

🧰 本地调试 GitHub Actions 的三种主流方式

1. 使用官方推荐的 `act` 工具（最常用、最接近真实环境）

act 是一个开源工具，可以在本地运行 GitHub Actions，模拟 GitHub 的 runner 环境。

🔧 安装

macOS（你常用的环境）：

brew install act


▶️ 运行 workflow

在你的仓库根目录执行：

act


如果你想运行特定事件，例如 push：

act push


运行特定 job：

act -j build


📝 注意事项

• 默认使用的 runner 是 ubuntu-latest 的轻量镜像，有些 action 可能缺依赖。
• 如果你需要更完整的环境：


act --container-architecture linux/amd64 -P ubuntu-latest=catthehacker/ubuntu:full-latest


这对你这种经常调试复杂工具链的人特别有用。

---

2. 使用 Docker 手动模拟 runner（适合深度调试）

如果你需要完全可控的环境（比如自定义依赖、插件、系统级工具），可以直接拉 GitHub runner 的官方 Docker 镜像：

docker run -it ghcr.io/actions/runner:latest


然后把你的 workflow 脚本挂载进去执行。

这种方式更适合你这种喜欢“可复现、可维护”的工作流设计者。

---

3. 使用 VSCode + GitHub Actions 插件（可视化调试）

VSCode 有一个插件：

GitHub Actions by GitHub

它可以：

• 语法检查
• 自动补全
• 本地模拟 workflow 结构
• 直接触发 act 运行


如果你已经在维护跨平台 keymap 和插件体系，这个方式会让你的调试体验更顺滑。

---

🧪 推荐给你的最佳实践（基于你的工作风格）

结合你对可维护性、可复现性和跨平台一致性的追求，我建议你采用：

act + VSCode 插件 + 自定义 Docker runner（可选）

这样你可以：

• 在本地快速迭代 YAML
• 保证环境一致性
• 把调试流程写成文档分享给团队（你擅长的事）


---

如果你愿意，我可以帮你：

• 生成一个适合你项目的 act 配置
• 给你的 workflow 做结构优化
• 帮你写一个“团队可复用的 GitHub Actions 本地调试指南”


你想让我先帮你优化现有的 workflow，还是先搭建本地调试环境呢？

-----



太好了，我们就一步一步把 GitHub Actions 的本地调试环境在你的 macOS 上搭建起来。按照你的风格，我会给你一个可复现、可维护、团队可共享的方案。

---

🧱 本地调试环境搭建（macOS）

🥇 第一步：安装 `act`（本地运行 GitHub Actions 的核心工具）

act 是目前最成熟、最接近 GitHub Actions 真机环境的本地模拟器。

安装（macOS）

brew install act


安装完成后确认：

act --version


---

🥈 第二步：准备 Docker（act 依赖 Docker）

你应该已经在用 Docker（因为你常用 Docker Compose + PostgreSQL），但还是确认一下：

docker --version


如果 Docker Desktop 没启动，记得打开它。

---

🥉 第三步：为你的仓库准备本地运行环境

进入你的项目根目录（包含 .github/workflows）：

cd your-project


然后直接试跑：

act


如果 workflow 监听的是 push：

act push


如果你想跑某个 job：

act -j build


---

🧩 第四步：使用更完整的 runner 镜像（强烈推荐给你）

默认镜像太轻量，很多工具链（Java、Node、Docker CLI 等）都没有。

你可以指定一个更完整的镜像：

act \
  --container-architecture linux/amd64 \
  -P ubuntu-latest=catthehacker/ubuntu:full-latest


这能最大程度模拟 GitHub Actions 的真实环境。

---

🧪 第五步：为你的项目创建 `.actrc`（让团队共享配置）

为了让团队成员也能一键运行，你可以在项目根目录创建 .actrc：

--container-architecture linux/amd64
-P ubuntu-latest=catthehacker/ubuntu:full-latest


之后只需要：

act


就能自动使用完整 runner。

---

🧱 第六步：处理 Secrets（本地调试必备）

你可以创建 .secrets 文件：

MY_TOKEN=xxxx
DB_PASSWORD=xxxx


然后运行：

act --secret-file .secrets


这样你就能在本地完整模拟 CI/CD。

---

🧭 第七步：VSCode 插件辅助（可选但很适合你）

安装插件：

GitHub Actions by GitHub

它能：

• 自动补全 YAML
• 检查语法
• 一键触发 act
• 可视化查看 workflow 结构


非常适合你这种喜欢“可维护、可分享”的工作流设计方式。

---

🎉 到这里，你的本地 GitHub Actions 调试环境就搭建好了

你现在可以：

• 本地跑 CI/CD
• 本地调试失败的 job
• 本地模拟 push/pull_request
• 本地验证 Docker、Gradle、Spring Boot 等步骤


---

如果你愿意，我可以帮你继续做一件事：
为你的项目生成一个完整的 .actrc + .secrets 模板，并优化你的 workflow 结构，让本地调试更顺畅。

你想让我帮你生成模板，还是先跑一个 workflow 看看效果呢。

----

太好了，我们继续把你的 GitHub Actions 本地调试环境一步步搭起来，让你马上能在 macOS 上跑起 workflow。

下面我会直接进入“动手”模式，把你需要的关键文件、命令和最佳实践全部铺好，让你可以复制就用。

---

🧱 第一步：确认 Docker + act 是否正常工作

1. 检查 Docker

docker --version


如果 Docker Desktop 没启动，记得打开它。

2. 检查 act

act --version


如果你已经安装过，那我们继续。如果还没装：

brew install act


---

🧱 第二步：在你的项目根目录创建 `.actrc`

这个文件让你和团队成员都能“一键 act”，不用每次输入复杂参数。

在项目根目录创建：

.actrc


内容如下（推荐给你这种需要完整工具链的开发者）：

--container-architecture linux/amd64
-P ubuntu-latest=catthehacker/ubuntu:full-latest
--secret-file .secrets


这样你只需要执行：

act


就能自动使用完整 runner + secrets。

---

🧱 第三步：创建 `.secrets` 文件（本地模拟 GitHub Secrets）

在项目根目录创建：

.secrets


内容示例：

GITHUB_TOKEN=ghp_xxxxx
DB_PASSWORD=local_dev_password
API_KEY=xxxx


你可以把 .secrets 加入 .gitignore：

.secrets


---

🧱 第四步：运行你的第一个本地 workflow

进入项目根目录：

cd your-project


运行默认事件（通常是 push）：

act


运行特定事件：

act push


运行特定 job：

act -j build


---

🧱 第五步：VSCode 插件辅助（可选但非常适合你）

安装插件：

GitHub Actions by GitHub

它能：

• 自动补全 YAML
• 检查语法
• 可视化 workflow
• 一键触发 act


这对你这种喜欢“可维护、可分享”的工作流体系非常友好。

---

🎉 到这里，你的本地 GitHub Actions 调试环境已经搭建完成

你现在可以：

• 本地跑 CI/CD
• 本地调试失败的 job
• 本地模拟 push/pull_request
• 本地验证 Docker、Gradle、Spring Boot、MyBatis 等步骤


---

如果你愿意，我可以帮你 生成一个适合你项目的 .actrc + .secrets 模板，或者帮你 检查你的 workflow 是否适合本地运行。

----




明白了，你的核心目标不是“搭建本地环境”本身，而是 为了在本地复现 GitHub Actions 的 token 错误并修复它。
那我们就直接围绕 如何在本地用 act 调试 token 错误 来给你一个精准、可操作的流程。

---

🔧 如何在本地调试 GitHub Actions 的 Token 错误

GitHub Actions 中最常见的 token 错误包括：

• GITHUB_TOKEN 权限不足
• 自定义 token（PAT）无效或过期
• Secrets 没有正确传入
• workflow 中引用错误（如 ${{ secrets.MY_TOKEN }} 拼错）


使用 act 本地调试时，你必须手动提供 token，否则 workflow 会报错。

下面是你需要做的完整步骤。

---

🧱 第一步：创建 `.secrets` 文件（关键）

在你的项目根目录创建：

.secrets


内容示例：

GITHUB_TOKEN=ghp_xxxxxxxx
MY_PAT=ghp_xxxxxxxx


你可以把所有 workflow 用到的 secrets 都放进去。

⚠️ 注意：act 不会自动生成 GITHUB_TOKEN，你必须自己提供。

---

🧱 第二步：让 act 使用这些 secrets

如果你已经创建了 .actrc，确保里面有：

--secret-file .secrets


如果没有 .actrc，你也可以直接运行：

act --secret-file .secrets


---

🧱 第三步：本地运行 workflow 并复现 token 错误

运行默认事件：

act


运行 push：

act push


运行特定 job：

act -j build


如果 token 有问题，你会在本地直接看到错误日志，例如：

• Bad credentials
• Resource not accessible by integration
• HttpError: 403
• Not Found（常见于 token 权限不足）


这样你就能快速定位问题。

---

🧱 第四步：常见 token 错误及解决方式

1. Bad credentials

说明 token 无效或过期。

解决：

• 重新生成 PAT
• 更新 .secrets 文件


---

2. Resource not accessible by integration

说明 GITHUB_TOKEN 权限不足。

解决： 在 workflow 中添加：

permissions:
  contents: write
  pull-requests: write


或者你需要使用 PAT 替代 GITHUB_TOKEN。

---

3. Secrets 没有传入 act

如果你看到：

Error: Input required and not supplied: token


说明 act 没有收到 secrets。

解决：

• 确认 .secrets 文件存在
• 确认 .actrc 中有 --secret-file .secrets
• 或运行：


act --secret-file .secrets


---

4. workflow 中引用错误

例如：

${{ secrets.MY_TOKE }}   # 拼错


本地 act 会直接报错，你可以快速修复。

---

🧱 第五步：验证修复是否成功

修改 token 或 workflow 后，再次运行：

act -j your_job


如果不再报错，说明 token 问题已经解决。

---

🎯 总结：你现在应该做什么

1. 在项目根目录创建 .secrets
2. 把你的 token 放进去
3. 用 act 运行 workflow
4. 查看本地日志，定位 token 错误
5. 修改 workflow 或 token
6. 再次用 act 验证修复是否成功


---

如果你愿意，我可以帮你：

• 检查你的 workflow 中 token 使用是否正确
• 帮你写一个 .secrets 模板
• 分析你遇到的具体 token 错误日志


你要不要把你的错误日志贴给我，我帮你精准定位问题。


----hgg



下面我给你一份 真正可用、深入、系统化的 act 调试指南。
不是简单命令罗列，而是围绕你这种“要复现问题、定位错误、验证修复”的目标来设计的。

---

🧭 `act` 的详细调试方法（从入门到深度排查）

我把它分成 6 个层次，从最基础到最强调试技巧，你可以按需使用。

---

1️⃣ 基础运行（确认 workflow 能跑）

运行默认事件（通常是 push）

act


指定事件

act push
act pull_request


指定 job

act -j build


---

2️⃣ 查看详细日志（调试 token 错误最常用）

开启 verbose 模式（强烈推荐）

act -v


开启 debug 模式（打印更多内部信息）

act -v --debug


超级详细（trace）

act -v --debug --trace


这些模式会显示：

• 每一步的输入输出
• action 的内部日志
• token 传递情况
• HTTP 请求失败原因（403、401、404）


对你调试 token 权限问题非常关键。

---

3️⃣ 调试 Secrets（你当前的核心需求）

使用 secrets 文件

act --secret-file .secrets


查看 act 是否正确加载 secrets

act -v --secret-file .secrets


你会看到类似：

[secret] GITHUB_TOKEN=***


如果没有显示，说明 secrets 没加载成功。

---

4️⃣ 调试 Token 权限问题（最常见的错误）

🔍 常见错误 1：Bad credentials

说明 token 无效或过期。

解决：

• 换一个 PAT
• 更新 .secrets


---

🔍 常见错误 2：Resource not accessible by integration

说明 GITHUB_TOKEN 权限不足。

解决：在 workflow 顶部加：

permissions:
  contents: write
  pull-requests: write


---

🔍 常见错误 3：Secrets 没传入 act

错误示例：

Error: Input required and not supplied: token


解决：

• .secrets 文件是否存在
• .actrc 是否包含 --secret-file .secrets
• 是否使用了 act --secret-file .secrets


---

5️⃣ 调试特定步骤（精准定位错误）

只运行某个 step

act -j build --step "Checkout code"


跳过某些 steps

act -j build --skip-steps "Install dependencies"


只运行失败的步骤（自动）

act --rerun-failed


---

6️⃣ 使用完整 runner 镜像（避免环境差异）

默认镜像太轻量，很多工具链缺失。

推荐你使用：

act \
  --container-architecture linux/amd64 \
  -P ubuntu-latest=catthehacker/ubuntu:full-latest


或者写入 .actrc：

--container-architecture linux/amd64
-P ubuntu-latest=catthehacker/ubuntu:full-latest
--secret-file .secrets


这样你每次只需要：

act


---

🧪 最强调试技巧：打印所有环境变量

在 workflow 中加入一个调试 step：

- name: Debug env
  run: env | sort


你可以看到：

• secrets 是否传入
• token 是否存在
• 环境变量是否正确


这是排查 token 问题最直接的方法。

---

🎯 最后给你一个“调试 token 错误”的标准流程

你可以照着这个 checklist 走：

1. 创建 .secrets 文件
2. 填入你的 PAT 或 token
3. 使用完整 runner 镜像
4. 运行：act -v --secret-file .secrets

5. 查看是否有：• Bad credentials
• 403
• Resource not accessible by integration

6. 如果是权限问题 → 修改 workflow 的 permissions
7. 如果是 token 无效 → 换 token
8. 再次运行：act -j your_job



你就能在本地 100% 复现并修复 token 错误。

---

如果你愿意，我可以帮你 分析你当前 workflow 的 token 使用是否正确，或者你可以把错误日志贴给我，我帮你精准定位问题。


