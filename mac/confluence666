好的，那我帮你把 快捷键触发功能 加到插件里，这样你可以在任何 Confluence 页面按下 Ctrl+Shift+T 来手动刷新表格布局。

---

📂 文件结构

confluence-table-fix/
 ├─ manifest.json
 ├─ content.js
 ├─ options.html
 └─ options.js


---

📜 manifest.json

{
  "manifest_version": 3,
  "name": "Confluence Table Auto Width",
  "version": "1.3",
  "description": "自动调整 Confluence 表格列宽（支持动态加载 + 配置选项 + 快捷键）",
  "permissions": ["storage", "scripting"],
  "options_page": "options.html",
  "commands": {
    "adjust-tables": {
      "suggested_key": {
        "default": "Ctrl+Shift+T"
      },
      "description": "手动调整当前页面的表格列宽"
    }
  },
  "content_scripts": [
    {
      "matches": ["https://*.atlassian.net/*"],
      "js": ["content.js"],
      "run_at": "document_idle"
    }
  ]
}


---

📜 content.js

function adjustTables(mode) {
  const tables = document.querySelectorAll("table.confluenceTable");
  tables.forEach(table => {
    const firstRow = table.querySelector("tr");
    if (!firstRow) return;

    const cols = firstRow.querySelectorAll("td, th");
    const colCount = cols.length;
    if (colCount === 0) return;

    cols.forEach((col, i) => {
      table.querySelectorAll(`tr td:nth-child(${i+1}), tr th:nth-child(${i+1})`)
        .forEach(cell => {
          if (mode === "fixed") {
            cell.style.width = "150px";
          } else {
            cell.style.width = (100 / colCount) + "%";
          }
          cell.style.wordBreak = "break-word";
        });
    });
  });
}

function init() {
  chrome.storage.sync.get("mode", data => {
    const mode = data.mode || "average"; // 默认平均分配
    adjustTables(mode);
  });
}

// 初次加载执行
window.addEventListener("load", init);

// 监听 DOM 变化（动态加载）
const observer = new MutationObserver(init);
observer.observe(document.body, { childList: true, subtree: true });

// 监听快捷键命令
chrome.runtime.onMessage.addListener((request) => {
  if (request.action === "adjustTables") {
    init();
  }
});


---

📜 background.js（新增）

chrome.commands.onCommand.addListener((command) => {
  if (command === "adjust-tables") {
    chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {
      chrome.tabs.sendMessage(tabs[0].id, {action: "adjustTables"});
    });
  }
});


---

⚙️ 使用方法

1. 在扩展目录里新增 background.js 文件，并在 manifest.json 里加上 commands 配置。
2. 加载扩展后，打开 Confluence 页面。
3. 按下 Ctrl+Shift+T，插件会立即重新调整当前页面的表格列宽。


---

这样你就有了一个 自动化 + 可配置 + 快捷键触发 的完整插件。

要不要我再帮你加一个 自定义宽度输入框（在选项页里输入具体像素值或百分比），让你完全自由设定列宽？