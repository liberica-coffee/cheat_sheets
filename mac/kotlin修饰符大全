Kotlin å¯è§æ€§ä¿®é¥°ç¬¦è¯¦è§£

Kotlin æœ‰å››ç§å¯è§æ€§ä¿®é¥°ç¬¦ï¼Œå®ƒä»¬æ§åˆ¶ç±»ã€æ¥å£ã€å‡½æ•°ã€å±æ€§ç­‰çš„è®¿é—®èŒƒå›´ã€‚

ğŸ“Š å››ç§å¯è§æ€§ä¿®é¥°ç¬¦æ¦‚è§ˆ

ä¿®é¥°ç¬¦ å«ä¹‰ è®¿é—®èŒƒå›´
public å…¬å¼€ ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è®¿é—®ï¼ˆé»˜è®¤ï¼‰
internal å†…éƒ¨ åŒä¸€æ¨¡å—å†…å¯ä»¥è®¿é—®
protected å—ä¿æŠ¤ æœ¬ç±»å’Œå­ç±»å¯ä»¥è®¿é—®
private ç§æœ‰ ä»…æœ¬ç±»/æœ¬æ–‡ä»¶å†…å¯ä»¥è®¿é—®

ğŸ” è¯¦ç»†è§£é‡Šä¸ç¤ºä¾‹

1. private - æœ€ä¸¥æ ¼çš„å¯è§æ€§

```kotlin
// æ–‡ä»¶ï¼šUser.kt

// 1. é¡¶å±‚å£°æ˜ï¼ˆæ–‡ä»¶çº§åˆ«ï¼‰
private val SECRET_KEY = "abc123"  // åªåœ¨å½“å‰æ–‡ä»¶å¯è§

private fun privateFunction() {    // åªåœ¨å½“å‰æ–‡ä»¶å¯è§
    println("Secret function")
}

// 2. ç±»å†…éƒ¨ä½¿ç”¨
class User(private val id: Int, val name: String) {
    // ç§æœ‰å±æ€§
    private var password: String = ""
    
    // ç§æœ‰æ–¹æ³•
    private fun validatePassword(pwd: String): Boolean {
        return pwd.length >= 8
    }
    
    // å…¬å¼€æ–¹æ³•å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜
    fun changePassword(newPassword: String) {
        if (validatePassword(newPassword)) {
            password = newPassword
            println("Password changed for user $id")
        }
    }
    
    // ç§æœ‰åµŒå¥—ç±»
    private class Token(val value: String)
    
    // å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰æˆå‘˜
    inner class Profile {
        fun showInfo() {
            println("User ID: $id")  // âœ… å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰å±æ€§
            // println("Password: $password")  // âœ… ä¹Ÿå¯ä»¥è®¿é—®
        }
    }
}

// 3. æ‰©å±•å‡½æ•°çš„ç§æœ‰æ€§
private fun User.privateExtension() {
    println("Private extension for User")
}

// åœ¨å…¶ä»–æ–‡ä»¶ä¸­ï¼š
// âŒ ä¸èƒ½è®¿é—®ï¼š
// SECRET_KEY
// privateFunction()
// User().password
// User().validatePassword()
// User.Token
```

2. protected - ç»§æ‰¿ä½“ç³»ä¸­çš„å¯è§æ€§

```kotlin
open class Animal {
    // å—ä¿æŠ¤çš„å±æ€§
    protected val species: String = "Animal"
    
    // å—ä¿æŠ¤çš„æ–¹æ³•
    protected fun makeSound() {
        println("Animal sound")
    }
    
    // å…¬å¼€æ–¹æ³•å¯ä»¥æš´éœ²å—ä¿æŠ¤çš„å†…å®¹
    fun introduce() {
        println("I am a $species")
        makeSound()
    }
    
    // ç§æœ‰å±æ€§ - å­ç±»ä¸èƒ½è®¿é—®
    private val secretCode = "123"
}

class Dog : Animal() {
    fun bark() {
        println("Dog barking")
        
        // âœ… å¯ä»¥è®¿é—®çˆ¶ç±»çš„ protected æˆå‘˜
        println("Species: $species")
        makeSound()
        
        // âŒ ä¸èƒ½è®¿é—®çˆ¶ç±»çš„ private æˆå‘˜
        // println(secretCode)
    }
    
    // å¯ä»¥è¦†ç›– protected æ–¹æ³•
    override protected fun makeSound() {
        super.makeSound()  // è°ƒç”¨çˆ¶ç±»å®ç°
        println("Woof!")
    }
}

// åœ¨å…¶ä»–åœ°æ–¹ï¼š
val dog = Dog()
dog.introduce()  // âœ… å…¬å¼€æ–¹æ³•
// dog.species    // âŒ ä¸èƒ½ç›´æ¥è®¿é—® protected å±æ€§
// dog.makeSound() // âŒ ä¸èƒ½ç›´æ¥è®¿é—® protected æ–¹æ³•
```

é‡è¦é™åˆ¶ï¼š

Â· protected ä¸èƒ½ç”¨äºé¡¶å±‚å£°æ˜ï¼ˆæ–‡ä»¶çº§ï¼‰
Â· åœ¨æ¥å£ä¸­ï¼Œprotected æ— æ•ˆï¼ˆæ¥å£æˆå‘˜é»˜è®¤æ˜¯å…¬å¼€çš„ï¼‰

3. internal - æ¨¡å—çº§åˆ«çš„å¯è§æ€§

```kotlin
// æ–‡ä»¶ï¼šauth.ktï¼ˆæ¨¡å— Aï¼‰
internal class AuthService {  // åªåœ¨æ¨¡å— A å†…å¯è§
    internal val API_KEY = "key123"  // æ¨¡å—å†…å¯è§
    
    internal fun authenticate(user: String): Boolean {
        return validateInternal(user)
    }
    
    private fun validateInternal(user: String): Boolean {
        return user.isNotEmpty()
    }
}

// åœ¨æ¨¡å— A çš„å…¶ä»–æ–‡ä»¶ä¸­ï¼š
fun test() {
    val auth = AuthService()  // âœ… å¯ä»¥è®¿é—®
    println(auth.API_KEY)     // âœ… å¯ä»¥è®¿é—®
    auth.authenticate("admin") // âœ… å¯ä»¥è°ƒç”¨
}

// --------------------------------------------------
// åœ¨æ¨¡å— B ä¸­ï¼š
// âŒ å®Œå…¨ä¸èƒ½è®¿é—® AuthService åŠå…¶æˆå‘˜
// val auth = AuthService()
// auth.API_KEY
```

ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ

Â· ä¸€ä¸ª IntelliJ IDEA æ¨¡å—
Â· ä¸€ä¸ª Maven/Gradle é¡¹ç›®
Â· é€šè¿‡ä¸€æ¬¡ Ant ä»»åŠ¡ç¼–è¯‘çš„ä¸€ç»„æ–‡ä»¶

4. public - é»˜è®¤çš„å¯è§æ€§

```kotlin
// æ–‡ä»¶ï¼šutils.kt

// é»˜è®¤å°±æ˜¯ publicï¼Œå¯ä»¥ä¸å†™
public val PI = 3.14159      // åœ¨ä»»ä½•åœ°æ–¹å¯è®¿é—®
val VERSION = "1.0"          // é»˜è®¤ä¹Ÿæ˜¯ public

public class Calculator {     // åœ¨ä»»ä½•åœ°æ–¹å¯è®¿é—®
    public fun add(a: Int, b: Int): Int = a + b
    fun subtract(a: Int, b: Int): Int = a - b  // é»˜è®¤ public
}

// åœ¨ä»»ä½•å…¶ä»–æ¨¡å—ã€æ–‡ä»¶ä¸­ï¼š
fun test() {
    println(PI)                // âœ…
    println(VERSION)           // âœ…
    val calc = Calculator()    // âœ…
    calc.add(1, 2)             // âœ…
    calc.subtract(3, 1)        // âœ…
}
```

ğŸ¯ åº”ç”¨åœ¨ä¸åŒä½ç½®çš„è§„åˆ™

1. åœ¨æ„é€ å‡½æ•°ä¸Šçš„å¯è§æ€§

```kotlin
// ä¸»æ„é€ å‡½æ•°é»˜è®¤æ˜¯ public
class User1(val name: String)  // å…¬å¼€æ„é€ å‡½æ•°

// ç§æœ‰æ„é€ å‡½æ•°ï¼ˆå•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ï¼‰
class Database private constructor() {
    companion object {
        private var instance: Database? = null
        
        fun getInstance(): Database {
            if (instance == null) {
                instance = Database()
            }
            return instance!!
        }
    }
}

// ä½¿ç”¨
// val db = Database()  // âŒ ä¸èƒ½ç›´æ¥æ„é€ 
val db = Database.getInstance()  // âœ… é€šè¿‡å·¥å‚æ–¹æ³•

// å—ä¿æŠ¤çš„æ„é€ å‡½æ•°
open class Base protected constructor(val id: Int)

class Derived : Base(1)  // âœ… å­ç±»å¯ä»¥è°ƒç”¨
// val base = Base(1)    // âŒ å¤–éƒ¨ä¸èƒ½è°ƒç”¨
```

2. åœ¨ getter/setter ä¸Šçš„å¯è§æ€§

```kotlin
class Person {
    // å±æ€§å…¬å¼€ï¼Œä½† setter ç§æœ‰
    var name: String = ""
        private set  // åªèƒ½åœ¨ç±»å†…éƒ¨ä¿®æ”¹
    
    // å±æ€§å…¬å¼€ï¼Œgetter å…¬å¼€ï¼Œsetter å†…éƒ¨å¯è§
    var age: Int = 0
        internal set
    
    fun changeName(newName: String) {
        name = newName  // âœ… ç±»å†…éƒ¨å¯ä»¥ä¿®æ”¹
    }
}

val person = Person()
person.name = "Alice"  // âŒ ç¼–è¯‘é”™è¯¯ï¼šsetter æ˜¯ç§æœ‰çš„
person.age = 25        // âœ… å¦‚æœåœ¨åŒä¸€æ¨¡å—å†…
```

3. åœ¨æ¥å£ä¸­çš„å¯è§æ€§

```kotlin
interface MyInterface {
    // æ¥å£æˆå‘˜é»˜è®¤æ˜¯ public
    fun publicMethod()
    
    // ä¸èƒ½ä½¿ç”¨ protected
    // protected fun protectedMethod()  // âŒ ç¼–è¯‘é”™è¯¯
    
    // å¯ä»¥ä½¿ç”¨ privateï¼ˆKotlin 1.4+ï¼‰
    private fun privateMethod() {
        println("Private interface method")
    }
    
    // é»˜è®¤å®ç°å¯ä»¥è°ƒç”¨ç§æœ‰æ–¹æ³•
    fun defaultMethod() {
        privateMethod()
        println("Default method")
    }
}

class MyClass : MyInterface {
    override fun publicMethod() {
        println("Implemented public method")
        // defaultMethod()  // âœ… å¯ä»¥è°ƒç”¨æ¥å£çš„é»˜è®¤æ–¹æ³•
    }
}
```

ğŸ”„ å¯è§æ€§ä¿®é¥°ç¬¦å¯¹æ¯”

è¡¨æ ¼æ€»ç»“

åœºæ™¯ public internal protected private
é¡¶å±‚å£°æ˜ æ‰€æœ‰åœ°æ–¹ æ¨¡å—å†… âŒ ä¸å…è®¸ æ–‡ä»¶å†…
ç±»æˆå‘˜ æ‰€æœ‰åœ°æ–¹ æ¨¡å—å†… å­ç±» ç±»å†…
æ¥å£æˆå‘˜ æ‰€æœ‰åœ°æ–¹ æ¨¡å—å†… âŒ ä¸å…è®¸ æ¥å£å†…
æ„é€ å‡½æ•° æ‰€æœ‰åœ°æ–¹ æ¨¡å—å†… å­ç±» ç±»å†…
getter/setter åŒå±æ€§ å¯å•ç‹¬è®¾ç½® å¯å•ç‹¬è®¾ç½® å¯å•ç‹¬è®¾ç½®

è®¿é—®èŒƒå›´å›¾ç¤º

```
æ–‡ä»¶A.kt
â”œâ”€â”€ privateTopLevel    â”€â”€â”
â”œâ”€â”€ internalTopLevel     â”‚ åŒä¸€æ¨¡å—
â”œâ”€â”€ publicTopLevel       â”‚
â””â”€â”€ class ClassA         â”‚
    â”œâ”€â”€ privateMember  â”€â”€â”˜ ä»… ClassA å†…
    â”œâ”€â”€ protectedMember â”€â”€â”¬â”€â” ClassA + å­ç±»
    â”œâ”€â”€ internalMember    â”‚ â”‚ åŒä¸€æ¨¡å—
    â””â”€â”€ publicMember      â”‚ â”‚ æ‰€æœ‰åœ°æ–¹
                          â”‚ â”‚
æ–‡ä»¶B.ktï¼ˆåŒä¸€æ¨¡å—ï¼‰      â”‚ â”‚
â””â”€â”€ class ClassB : ClassAâ”€â”˜ â”‚
    â””â”€â”€ å¯è®¿é—®ï¼š             â”‚
        - protectedMember   â”‚
        - internalMember    â”‚
        - publicMember      â”‚
                           â”‚
æ–‡ä»¶C.ktï¼ˆä¸åŒæ¨¡å—ï¼‰        â”‚
â””â”€â”€ åªèƒ½è®¿é—®ï¼š              â”‚
    - publicTopLevel       â”‚
    - publicMember â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ› ï¸ å®é™…åº”ç”¨åœºæ™¯

1. å°è£…æ•°æ®ï¼ˆEncapsulationï¼‰

```kotlin
class BankAccount {
    private var balance: Double = 0.0
    
    fun deposit(amount: Double) {
        if (amount > 0) {
            balance += amount
            logTransaction("Deposit: $amount")
        }
    }
    
    fun withdraw(amount: Double): Boolean {
        if (amount > 0 && balance >= amount) {
            balance -= amount
            logTransaction("Withdraw: $amount")
            return true
        }
        return false
    }
    
    fun getBalance(): Double = balance
    
    private fun logTransaction(message: String) {
        println("Transaction: $message, Balance: $balance")
    }
}

// ä½¿ç”¨
val account = BankAccount()
account.deposit(1000.0)
account.withdraw(500.0)
println(account.getBalance())
// account.balance = 1000000  // âŒ ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œä¿è¯æ•°æ®å®‰å…¨
```

2. æ¨¡å—åŒ–è®¾è®¡

```kotlin
// æ¨¡å—ï¼šdatabase
internal class DatabaseConnection {  // å†…éƒ¨å®ç°ç»†èŠ‚
    internal fun connect() { ... }
    internal fun disconnect() { ... }
}

public class UserRepository {  // å…¬å¼€API
    private val db = DatabaseConnection()
    
    public fun getUsers(): List<User> {
        db.connect()
        // æŸ¥è¯¢é€»è¾‘
        db.disconnect()
        return emptyList()
    }
}

// å…¶ä»–æ¨¡å—åªèƒ½ä½¿ç”¨ UserRepositoryï¼Œä¸èƒ½ç›´æ¥è®¿é—® DatabaseConnection
```

3. ç»§æ‰¿è®¾è®¡

```kotlin
abstract class PaymentProcessor {
    // æ¨¡æ¿æ–¹æ³•æ¨¡å¼
    fun processPayment(amount: Double): Boolean {
        validate()
        val result = executePayment(amount)
        logPayment(result)
        return result
    }
    
    protected abstract fun executePayment(amount: Double): Boolean
    
    protected open fun validate(): Boolean = true
    
    private fun logPayment(success: Boolean) {
        println("Payment ${if (success) "succeeded" else "failed"}")
    }
}

class CreditCardProcessor : PaymentProcessor() {
    override protected fun executePayment(amount: Double): Boolean {
        println("Processing credit card payment: $$amount")
        return true
    }
    
    override protected fun validate(): Boolean {
        println("Validating credit card...")
        return super.validate()
    }
}
```

âš ï¸ å¸¸è§é”™è¯¯ä¸æ³¨æ„äº‹é¡¹

1. è¿‡åº¦ä½¿ç”¨ private

```kotlin
// âŒ è¿‡åº¦å°è£…
class OverEncapsulated {
    private var a: Int = 0
    private var b: Int = 0
    private var c: Int = 0
    
    fun setA(value: Int) { a = value }
    fun getA(): Int = a
    fun setB(value: Int) { b = value }
    fun getB(): Int = b
    // ... å†—é•¿çš„getter/setter
}

// âœ… é€‚å½“å°è£…
data class UserInfo(
    val name: String,
    val email: String,
    private val password: String  // æ•æ„Ÿä¿¡æ¯åº”è¯¥ç§æœ‰
)
```

2. Java äº’æ“ä½œæ€§é—®é¢˜

```kotlin
// Kotlin ä¸­çš„ internal
internal class InternalClass

// Java ä¸­ä¼šå˜æˆ publicï¼ˆä½†åç§°ä¼šè¢«ä¿®é¥°ï¼‰
// å®é™…ç¼–è¯‘åï¼šInternalClass å˜æˆ public
// ä½†åå­—ä¼šå˜æˆï¼šInternalClass$moduleName
```

3. å¯è§æ€§ä¸ä¸€è‡´

```kotlin
open class Parent {
    // âŒ ä¸å¥½çš„è®¾è®¡ï¼šå…¬å¼€æ–¹æ³•è¿”å›ç§æœ‰ç±»å‹
    private class Inner
    open fun create(): Inner = Inner()
}

class Child : Parent() {
    // âŒ ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½è¦†ç›–ï¼Œå› ä¸ºè¿”å›ç±»å‹ä¸å¯è®¿é—®
    // override fun create(): Inner = Inner()
}
```

ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

1. æœ€å°æƒé™åŸåˆ™ï¼šä» private å¼€å§‹ï¼ŒæŒ‰éœ€æ”¾å®½
2. å¤šç”¨ internalï¼šåœ¨æ¨¡å—å†…å…¬å¼€ï¼Œå¯¹å¤–éšè—å®ç°
3. æ…ç”¨ protectedï¼šä¼šå¯¼è‡´å¼ºè€¦åˆï¼Œä¼˜å…ˆè€ƒè™‘ç»„åˆ
4. åˆç†ä½¿ç”¨ publicï¼šAPI è¾¹ç•Œè¦æ¸…æ™°
5. æµ‹è¯•è€ƒè™‘ï¼šéœ€è¦æµ‹è¯•æ—¶ï¼Œé€‚å½“æ”¾å®½å¯è§æ€§æˆ–ç”¨ internal

```kotlin
// å¥½çš„å¯è§æ€§è®¾è®¡ç¤ºä¾‹
class ShoppingCart {
    // ç§æœ‰ï¼šå†…éƒ¨çŠ¶æ€
    private val items = mutableListOf<CartItem>()
    private var discount = 0.0
    
    // å…¬å¼€ï¼šæ ¸å¿ƒAPI
    fun addItem(item: CartItem) { ... }
    fun removeItem(itemId: String) { ... }
    fun getTotal(): Double { ... }
    
    // å†…éƒ¨ï¼šæ¨¡å—å†…éƒ¨ä½¿ç”¨
    internal fun applyDiscount(code: String) { ... }
    
    // å—ä¿æŠ¤ï¼šä¸ºæ‰©å±•è®¾è®¡
    protected open fun validateItem(item: CartItem): Boolean = ...
}

// æµ‹è¯•æ—¶å¯ä»¥æ”¾åœ¨åŒä¸€æ¨¡å—è®¿é—® internal æˆå‘˜
// æˆ–è€…ä½¿ç”¨ @VisibleForTesting æ³¨è§£
```

è®°ä½ï¼šå¯è§æ€§ä¿®é¥°ç¬¦ä¸ä»…æ˜¯æŠ€æœ¯é€‰æ‹©ï¼Œæ›´æ˜¯è®¾è®¡å†³ç­–ã€‚å¥½çš„å¯è§æ€§è®¾è®¡èƒ½è®©ä»£ç æ›´å®‰å…¨ã€æ›´æ˜“ç»´æŠ¤ã€æ›´æ¨¡å—åŒ–ã€‚

ä½ åœ¨å®é™…é¡¹ç›®ä¸­é‡åˆ°è¿‡å¯è§æ€§ç›¸å…³çš„é—®é¢˜å—ï¼Ÿæ¯”å¦‚ Java äº’æ“ä½œã€æµ‹è¯•å›°éš¾ã€æˆ–è€…è®¾è®¡å›°æƒ‘ï¼Ÿæˆ‘å¯ä»¥æä¾›é’ˆå¯¹æ€§çš„å»ºè®®ï¼